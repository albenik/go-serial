language: go

dist: bionic

os:
  - linux
  - osx
  - windows

go:
  - 1.12.x
  - 1.13.x
  - master

go_import_path: github.com/albenik/go-serial/v2

env:
  global:
    - GO111MODULE=on
    - BUILD_GO386=387
    - BUILD_GOARM=5
  matrix:
    - BUILD_GOOS=linux BUILD_GOARCH=amd64
    - BUILD_GOOS=linux BUILD_GOARCH=386
    - BUILD_GOOS=linux BUILD_GOARCH=arm
    - BUILD_GOOS=windows BUILD_GOARCH=386
    - BUILD_GOOS=windows BUILD_GOARCH=amd64
    - BUILD_GOOS=darwin BUILD_GOARCH=386
    - BUILD_GOOS=darwin BUILD_GOARCH=amd64
    - BUILD_GOOS=freebsd BUILD_GOARCH=amd64
    - BUILD_GOOS=openbsd BUILD_GOARCH=amd64
    - BUILD_GOOS=openbsd BUILD_GOARCH=386
    - BUILD_GOOS=openbsd BUILD_GOARCH=arm

matrix:
  allow_failures:
    - env: BUILD_GOOS=openbsd BUILD_GOARCH=arm
  exclude:
    - os: windows
      go: master

script:
  - go vet ./...
  - go test -v ./...
  - GOOS=$BUILD_GOOS GOARCH=$BUILD_GOARCH GO386=$BUILD_GO386 GOARM=$BUILD_GOARM go test -v -c
  - GOOS=$BUILD_GOOS GOARCH=$BUILD_GOARCH GO386=$BUILD_GO386 GOARM=$BUILD_GOARM go build -v

notifications:
  email:
    recipients:
      - albenik@gmail.com
    on_success: change
    on_failure: always
